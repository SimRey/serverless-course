scripts:
  runserver: uvicorn src.main:app --reload
  test: pytest src/tests.py

  # Build Docker image
  build: docker build -f Dockerfile -t serverless-py .

  # Run container using the PORT variable from .env
  run: |
    export $(grep -v '^#' .env | xargs) && \
    docker run --env-file .env -p ${PORT:-8000}:${PORT:-8000} --rm --name serverless_py -it serverless-py

  # Open a shell inside the running container
  shell: docker exec -it serverless_py /bin/bash

  build_run:
    - rav run build
    - rav run run

  # Push image to Docker Hub
  push:
    - docker build -f Dockerfile -t serverless-py .
    - docker tag serverless-py simrey/serverless-py:latest
    - docker push simrey/serverless-py:latest

  pull_run: |
    docker pull simrey/serverless-py:latest && \
    export $(grep -v '^#' .env | xargs) && \
    docker run --env-file .env -p ${PORT:-8000}:${PORT:-8000} --rm --name serverless_py -it simrey/serverless-py:latest
